<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zextras Suite Installation Guide &mdash; Zextras Suite 0.1-alpha documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.d53ab927f7bad3eaa42da95908504b10.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/suite.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/design-tabs.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Zextras Backup" href="backup.html" />
    <link rel="prev" title="Introduction" href="general.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #00506d" >
            <a href="index.html" class="icon icon-home"> Zextras Suite
            <img src="_static/zextras_white.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="general.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Zextras Suite Installation Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-info">Basic Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#minimum-requirements-and-tweaking">Minimum Requirements and Tweaking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installation-possibilities">Installation possibilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#components">Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-zextras-zimlets">Other Zextras Zimlets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#where-to-get-the-zextras-suite-package">Where to get the Zextras Suite package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setup-information">Setup Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#zal-an-abstraction-layer-for-zimbra">ZAL - an Abstraction Layer for Zimbra</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-zimbra-dos-filter">The Zimbra DoS Filter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-the-dos-filter-can-affect-your-zextras-suite-experience">How the DoS Filter can affect your Zextras Suite experience</a></li>
<li class="toctree-l4"><a class="reference internal" href="#managing-the-dos-filter">Managing the DoS Filter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#oip-logging-issue">OIP Logging and non-Zimbra Proxies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nginx-templates-oip">Modify Nginx Templates Files for Correct OIP Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zimbra-upgrade">Zimbra Upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zimbra-patches">Zimbra Patches</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#quick-installation">Quick Installation Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#zextras-suite-on-multiserver-infrastructures">Zextras Suite on Multiserver infrastructures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setup-single-store">Installing Zextras Suite on a Single-store infrastructure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-multiserver">Installing Zextras Suite on a Multistore infrastructure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#detailed-instructions">Detailed Instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#zx-full-install">Zextras Suite Full Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zextras-suite-core-installation">Zextras Suite Core Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zextras-suite-zimlet-installation">Zextras Suite Zimlet Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zx-full-upgrade">Zextras Suite Full Upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upgrading-zextras-suite-on-a-multiserver-infrastructure">Upgrading Zextras Suite on a Multiserver infrastructure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zextras-suite-uninstallation">Zextras Suite Uninstallation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#post-install-and-post-uninstall">Post-Install and Post-Uninstall</a></li>
<li class="toctree-l2"><a class="reference internal" href="#additional-components">Additional Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#zextras-client">Zextras Client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#deploy-the-zextras-client">Deploy the Zextras Client</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#enable-the-zextras-client">Enable the Zextras Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#update-the-zextras-client">Update the Zextras Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#remove-the-zextras-client">Remove the Zextras Client</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="backup.html">Zextras Backup</a></li>
<li class="toctree-l1"><a class="reference internal" href="mobile.html">Zextras Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="powerstore.html">Zextras Powerstore</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin.html">Zextras Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="drive.html">Zextras Drive</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs.html">Zextras Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="auth.html">Zextras Auth</a></li>
<li class="toctree-l1"><a class="reference internal" href="team.html">Zextras Team</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">CLI</a></li>
</ul>

<hr />
<ul>
  <li class="toctree-l1">
    <a href="/landing/html/home.html">Back to
      Zextras Documentation hub
    </a>
  </li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #00506d" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Zextras Suite</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Zextras Suite Installation Guide</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note">
<p class="admonition-title">Note</p>
<p>All content is provisional and is meant <strong>only</strong> to showcase
the feature of the new framework.</p>
</div>
<section id="zextras-suite-installation-guide">
<h1><a class="toc-backref" href="#id30">Zextras Suite Installation Guide</a><a class="headerlink" href="#zextras-suite-installation-guide" title="Permalink to this headline"></a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date</dt>
<dd class="field-odd"><p>2021-10-20</p>
</dd>
</dl>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#zextras-suite-installation-guide" id="id30">Zextras Suite Installation Guide</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-info" id="id31">Basic Information</a></p>
<ul>
<li><p><a class="reference internal" href="#prerequisites" id="id32">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#minimum-requirements-and-tweaking" id="id33">Minimum Requirements and Tweaking</a></p></li>
<li><p><a class="reference internal" href="#installation-possibilities" id="id34">Installation possibilities</a></p></li>
<li><p><a class="reference internal" href="#components" id="id35">Components</a></p></li>
<li><p><a class="reference internal" href="#other-zextras-zimlets" id="id36">Other Zextras Zimlets</a></p></li>
<li><p><a class="reference internal" href="#where-to-get-the-zextras-suite-package" id="id37">Where to get the Zextras Suite package</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#setup-information" id="id38">Setup Information</a></p>
<ul>
<li><p><a class="reference internal" href="#zal-an-abstraction-layer-for-zimbra" id="id39">ZAL - an Abstraction Layer for Zimbra</a></p></li>
<li><p><a class="reference internal" href="#the-zimbra-dos-filter" id="id40">The Zimbra DoS Filter</a></p></li>
<li><p><a class="reference internal" href="#oip-logging-issue" id="id41">OIP Logging and non-Zimbra Proxies</a></p></li>
<li><p><a class="reference internal" href="#nginx-templates-oip" id="id42">Modify Nginx Templates Files for Correct OIP Logging</a></p></li>
<li><p><a class="reference internal" href="#zimbra-upgrade" id="id43">Zimbra Upgrade</a></p></li>
<li><p><a class="reference internal" href="#zimbra-patches" id="id44">Zimbra Patches</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#quick-installation" id="id45">Quick Installation Guide</a></p>
<ul>
<li><p><a class="reference internal" href="#zextras-suite-on-multiserver-infrastructures" id="id46">Zextras Suite on Multiserver infrastructures</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#detailed-instructions" id="id47">Detailed Instructions</a></p>
<ul>
<li><p><a class="reference internal" href="#zx-full-install" id="id48">Zextras Suite Full Installation</a></p></li>
<li><p><a class="reference internal" href="#zextras-suite-core-installation" id="id49">Zextras Suite Core Installation</a></p></li>
<li><p><a class="reference internal" href="#zextras-suite-zimlet-installation" id="id50">Zextras Suite Zimlet Installation</a></p></li>
<li><p><a class="reference internal" href="#zx-full-upgrade" id="id51">Zextras Suite Full Upgrade</a></p></li>
<li><p><a class="reference internal" href="#upgrading-zextras-suite-on-a-multiserver-infrastructure" id="id52">Upgrading Zextras Suite on a Multiserver infrastructure</a></p></li>
<li><p><a class="reference internal" href="#zextras-suite-uninstallation" id="id53">Zextras Suite Uninstallation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#post-install-and-post-uninstall" id="id54">Post-Install and Post-Uninstall</a></p></li>
<li><p><a class="reference internal" href="#additional-components" id="id55">Additional Components</a></p>
<ul>
<li><p><a class="reference internal" href="#zextras-client" id="id56">Zextras Client</a></p></li>
<li><p><a class="reference internal" href="#enable-the-zextras-client" id="id57">Enable the Zextras Client</a></p></li>
<li><p><a class="reference internal" href="#update-the-zextras-client" id="id58">Update the Zextras Client</a></p></li>
<li><p><a class="reference internal" href="#remove-the-zextras-client" id="id59">Remove the Zextras Client</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>This section contains various information—​requirements, configuration
details, and guidelines—​for a successful installation of Zextras Suite.
Please read carefully next section, <a class="reference external" href="#basic-info">Basic Information</a>,
to make sure you do not miss any important piece required to set up
Zextras Suite.</p>
<section id="basic-info">
<span id="id1"></span><h2><a class="toc-backref" href="#id31">Basic Information</a><a class="headerlink" href="#basic-info" title="Permalink to this headline"></a></h2>
<section id="prerequisites">
<span id="id2"></span><h3><a class="toc-backref" href="#id32">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Permalink to this headline"></a></h3>
<p>To use the Zextras suite, no additional software beyond what’s required
by a standard Zimbra deployment is necessary in order to install Zextras
Suite. If you did not yet install Zimbra, you can check <a class="reference external" href="https://zimbra.github.io/installguides/latest/single.html#System_Requirements">Zimbra’s System
Requirements</a>.</p>
<p>If you plan to use either <a class="reference external" href="./drive.xml">./drive.xml</a>,
<a class="reference external" href="./team.xml">./team.xml</a>, or both, you need some additional setup.
These two apps, indeed, need to communicate using web sockets on ports
<strong>tcp 8742</strong> and <strong>tcp 8743</strong> respectively, therefore you need to edit
file <code class="docutils literal notranslate"><span class="pre">/opt/zimbra/conf/nginx/includes/nginx.conf.web</span></code> to include the
following code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">upstream</span> <span class="n">zx</span>
    <span class="p">{</span>
        <span class="n">server</span>    <span class="n">mail</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">8742</span> <span class="n">fail_timeout</span><span class="o">=</span><span class="mi">5</span><span class="n">s</span> <span class="n">version</span><span class="o">=</span><span class="mf">8.8</span><span class="o">.</span><span class="mi">15</span><span class="n">_GA_20201272</span><span class="p">;</span>
        <span class="n">zmauth_zx</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">#  Define the collection of upstream HTTPS servers to dedicated zx ssl port of jetty</span>
    <span class="n">upstream</span> <span class="n">zx_ssl</span>
    <span class="p">{</span>
        <span class="n">server</span>    <span class="n">mail</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">8743</span> <span class="n">fail_timeout</span><span class="o">=</span><span class="mi">5</span><span class="n">s</span> <span class="n">version</span><span class="o">=</span><span class="mf">8.8</span><span class="o">.</span><span class="mi">15</span><span class="n">_GA_20201272</span><span class="p">;</span>
        <span class="n">zmauth_zx</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>replace <em>mail.example.com</em> with your server.</p></li>
</ul>
<blockquote>
<div><p><strong>Note</strong></p>
<p>In the reminder of this installation guide, all commands <strong>must</strong> be
executed as <code class="docutils literal notranslate"><span class="pre">root</span></code>, unless differently specified</p>
</div></blockquote>
</section>
<section id="minimum-requirements-and-tweaking">
<span id="id3"></span><h3><a class="toc-backref" href="#id33">Minimum Requirements and Tweaking</a><a class="headerlink" href="#minimum-requirements-and-tweaking" title="Permalink to this headline"></a></h3>
<p>If you are interested in resources optimization and tweaking, we suggest
to read the following article on the Zimbra wiki, which despite the
title applies to both large and small deployments:
<a class="reference external" href="http://wiki.zimbra.com/wiki/Performance_Tuning_Guidelines_for_Large_Deployments">http://wiki.zimbra.com/wiki/Performance_Tuning_Guidelines_for_Large_Deployments</a>.</p>
<p>Another strict requirement is the composition of the Zimbra IDs in the
system, which can only contain the following characters up to a maximum
length of 64:</p>
<ul class="simple">
<li><p>Lowercase and uppercase letters</p></li>
<li><p>Number</p></li>
<li><p>The following symbols: _ - # ( ) = &#64;</p></li>
</ul>
<p>Zimbra IDs containing other characters than the allowed ones will likely
cause problems to the Mobile module and possibly to other modules as
well.</p>
</section>
<section id="installation-possibilities">
<span id="id4"></span><h3><a class="toc-backref" href="#id34">Installation possibilities</a><a class="headerlink" href="#installation-possibilities" title="Permalink to this headline"></a></h3>
<p>These are the alternatives to install Zextras:</p>
<ul class="simple">
<li><p>single-store installation on a single server. This is the easiest and
is described in Section <a class="reference external" href="#quick-installation">Quick Installation
Guide</a>.</p></li>
<li><p>single-store installation on a multiserver. This approach is
equivalent to the previous one and applies when the installation is
in a multiserver installation, see <a class="reference external" href="#setup-single-store">Installing Zextras Suite on a
Single-store infrastructure</a>.</p></li>
<li><p>multistore installation: This approach is required if yuo need to ru
multiple <code class="docutils literal notranslate"><span class="pre">mailboxd</span></code> services, see <a class="reference external" href="#setup-multiserver">Installing Zextras Suite on a
Multistore infrastructure</a></p></li>
</ul>
</section>
<section id="components">
<span id="id5"></span><h3><a class="toc-backref" href="#id35">Components</a><a class="headerlink" href="#components" title="Permalink to this headline"></a></h3>
<p>Zextras Suite is comprised of three major components:</p>
<ul class="simple">
<li><p><strong>Zextras Core</strong>, abbreviated as <em>Core</em>, which is a jar package
extending Zimbra</p></li>
<li><p><strong>Zextras Administration Zimlet</strong>, abbreviated as Zextras Suite
Zimlet or just Zimlet, an administrative zimlet to access and manage
the Core.</p></li>
<li><p><strong>ZAL</strong> - An Open Source abstraction layer for Zimbra. Please read
<a class="reference external" href="#setup-zal">these advises</a> about ZAL insallation.</p></li>
</ul>
<p>The installation script follows the aforementioned structure allowing
you three installation targets: <strong>core</strong>, <strong>zimlet</strong>, and <strong>all</strong>. The
latter is equivalent of installing <em>Core</em> and immediately afterwards
<em>zimlet</em>.</p>
</section>
<section id="other-zextras-zimlets">
<span id="id6"></span><h3><a class="toc-backref" href="#id36">Other Zextras Zimlets</a><a class="headerlink" href="#other-zextras-zimlets" title="Permalink to this headline"></a></h3>
<p>While the Zextras Suite package includes the Zextras Administration
Zimlet, the Zextras Client Zimlet must be deployed separately. Check
section <a class="reference external" href="#zxclient">Zxclient</a> at the bottom of this page for
directions</p>
</section>
<section id="where-to-get-the-zextras-suite-package">
<span id="id7"></span><h3><a class="toc-backref" href="#id37">Where to get the Zextras Suite package</a><a class="headerlink" href="#where-to-get-the-zextras-suite-package" title="Permalink to this headline"></a></h3>
<p>The Zextras Suite installer can be obtained from the <a class="reference external" href="https://www.zextras.com/download">download
section</a> of zextras’ website, while
<em>existing customers</em> will be able to find <a class="reference external" href="https://www.zextras.com/download-customer/">a direct download
link</a> after logging in
with their Zextras Store account.</p>
</section>
</section>
<section id="setup-information">
<span id="id8"></span><h2><a class="toc-backref" href="#id38">Setup Information</a><a class="headerlink" href="#setup-information" title="Permalink to this headline"></a></h2>
<p>This section contains general information about the set up of the
system, installation troubleshooting, and important advices about the
upgrade to new version of both Zimbra and Zextras.</p>
<section id="zal-an-abstraction-layer-for-zimbra">
<span id="setup-zal"></span><h3><a class="toc-backref" href="#id39">ZAL - an Abstraction Layer for Zimbra</a><a class="headerlink" href="#zal-an-abstraction-layer-for-zimbra" title="Permalink to this headline"></a></h3>
<p>The Zextras Abstraction Layer (<strong>ZAL</strong>) is an Open Source abstraction
layer created to allow any extension to easily communicate with Zimbra
Collaboration Suite, regardless of the version in use.</p>
<p>It is released under the GPL license and thus cannot be included in the
Zextras Suite package, but during the installation process the <em>Zextras
Installer</em> will automatically detect the most appropriate library
version and will download and install it autonomously.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>Should the automatic download fail, the installation will end.
However, a direct download link will be provided: the downloaded file
must be renamed to <strong>zal.jar</strong> and copied into the <em>packages/</em>
subdirectory of the Zextras Suite installation package. A restart of
the installer will detect the new file and install it along with
Zextras Suite.</p>
</div></blockquote>
</section>
<section id="the-zimbra-dos-filter">
<span id="dos-filter"></span><h3><a class="toc-backref" href="#id40">The Zimbra DoS Filter</a><a class="headerlink" href="#the-zimbra-dos-filter" title="Permalink to this headline"></a></h3>
<p>Starting from Zimbra 8.0.0, a connection throttling mechanism called
<strong>DoS Filter</strong> has been added in order to reduce the impact of Denial of
Service attacks. By default the DoS Filter only allows <strong>30 connections
per second</strong>, rejecting any exceeding connection with a <em>503</em> HTTP
error.</p>
<section id="how-the-dos-filter-can-affect-your-zextras-suite-experience">
<span id="id9"></span><h4>How the DoS Filter can affect your Zextras Suite experience<a class="headerlink" href="#how-the-dos-filter-can-affect-your-zextras-suite-experience" title="Permalink to this headline"></a></h4>
<p>Being an Administrative Zimlet, the Zextras Administration Zimlet is
loaded upon logging into the Zimbra Administration Console; in order to
retrieve all relevant data, many requests are done and this can trigger
Zimbra’s DoS Filter, causing slowness, AJAX Errors, and general UI
corruption (e.g. empty text boxes or incoherent checkbox state).</p>
<p>DoS Filter warnings can be found and identified in the log file
<code class="docutils literal notranslate"><span class="pre">/opt/zimbra/log/zmmailboxd.out</span></code>, where messages like the following
one can be found:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span> <span class="mi">10</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">51.917</span><span class="p">:</span><span class="n">WARN</span><span class="p">:</span><span class="n">oejs</span><span class="o">.</span><span class="n">DoSFilter</span><span class="p">:</span><span class="n">qtp1027591600</span><span class="o">-</span>
<span class="mi">190</span><span class="p">:</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">73.35</span><span class="p">:</span><span class="mi">7071</span><span class="o">/</span><span class="n">service</span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">soap</span><span class="o">/</span><span class="n">GetAllZimletsRequest</span><span class="p">:</span>
<span class="n">DOS</span> <span class="n">ALERT</span><span class="p">:</span> <span class="n">Request</span> <span class="n">rejected</span> <span class="n">ip</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">73.73</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">null</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">null</span>
</pre></div>
</div>
</section>
<section id="managing-the-dos-filter">
<span id="id10"></span><h4>Managing the DoS Filter<a class="headerlink" href="#managing-the-dos-filter" title="Permalink to this headline"></a></h4>
<p>There are 3 different configuration properties controlling the DoS
Filter:</p>
<ul class="simple">
<li><p><a class="reference external" href="#dosfilter-delay">zimbraHttpDosFilterDelayMillis</a></p></li>
<li><p><a class="reference external" href="#dosfilter-mrs">zimbraHttpDosFilterMaxRequestsPerSec</a></p></li>
<li><p><a class="reference external" href="#dosfilter-wl">zimbraHttpThrottleSafeIPs</a></p></li>
</ul>
<p>Each attribute is inherited from global or is configurable at the server
level.</p>
<blockquote>
<div><p><strong>Tip</strong></p>
<p>The recommendation is to preserve the default configuration whenever
possible.</p>
</div></blockquote>
<p><strong>DoSFilter Delay (milliseconds) - zimbraHttpDosFilterDelayMillis.</strong></p>
<p>Delay is enforced on all requests over the rate limit, before they are
considered at all.</p>
<ul class="simple">
<li><p><strong>-1</strong> = Reject request</p></li>
<li><p><strong>0</strong> = No delay</p></li>
<li><p><strong>Any</strong> other integer value = Delay in ms</p></li>
</ul>
<p>The default is <em>-1</em>.</p>
<p>To modify in the global configuration (e.g. set the delay to 20ms):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zmprov</span> <span class="n">mcf</span> <span class="n">zimbraHttpDosFilterDelayMillis</span> <span class="mi">20</span>
</pre></div>
</div>
<p><strong>DoSFilter Maximum Requests Per Second -
zimbraHttpDosFilterMaxRequestsPerSec.</strong></p>
<p>Maximum number of requests per second from a connection. All requests in
excess of this value are throttled. The default is 30 and the minimum is
1.</p>
<p>To set the maximum number for requests in the global configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zmprov</span> <span class="n">mcf</span> <span class="n">zimbraHttpDosFilterMaxRequestsPerSec</span> <span class="mi">100</span>
</pre></div>
</div>
<p><strong>DoSFilter IP Addresses Whitelist - zimbraHttpThrottleSafeIPs.</strong></p>
<p>IP addresses to ignore when applying Jetty DosFilter. While this
attribute does not have a default value, nonetheless these loopback IPs
are whitelisted by default:</p>
<ul class="simple">
<li><p>127.0.0.1</p></li>
<li><p>::1</p></li>
<li><p>0:0:0:0:0:0:0:1</p></li>
<li><p>All mailboxd servers</p></li>
</ul>
<p>You can check if these hosts have been correctly whitelisted by the log
entry in <code class="docutils literal notranslate"><span class="pre">/opt/zimbra/log/mailbox.log</span></code>. This log entry should contain
all of the default whitelisted hosts as well as any IPs added to
<strong>zimbraHttpThrottleSafeIPs</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">09</span> <span class="mi">10</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">47</span><span class="p">,</span><span class="mi">772</span> <span class="n">INFO</span>  <span class="p">[</span><span class="n">main</span><span class="p">]</span> <span class="p">[]</span> <span class="n">misc</span> <span class="o">-</span> <span class="n">DoSFilter</span><span class="p">:</span> <span class="n">Configured</span>
<span class="n">whitelist</span> <span class="n">IPs</span> <span class="o">=</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">234.130</span><span class="p">,</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">,::</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span>
</pre></div>
</div>
<p>See how to add single IP addresses or IP ranges in the <a class="reference external" href="#dosfilter-examples">examples
below</a>.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>Proxy nodes should not need to be whitelisted, as long as the
<em>Originating-IP feature</em> is correctly configured in ZCS, see
<a class="reference external" href="https://wiki.zimbra.com/wiki/Log_Files#Logging_the_Originating_IP">https://wiki.zimbra.com/wiki/Log_Files#Logging_the_Originating_IP</a>.</p>
</div></blockquote>
<p>External hosts that makes SOAP requests for provisioning or any kind of
integration must be added to the IP whitelist to ensure DoSFilter does
not block some requests. This is also required whenever there are
network resources outside of Zimbra (like e.g., proxies, bouncers,
load-balancing servers, firewall, NATting devices) between the clients
and Zimbra). In any of these cases, please refer to the next sections
(<a class="reference external" href="#oip-logging-issue">OIP Logging and non-Zimbra Proxies</a> and <a class="reference external" href="#nginx-templates-oip">Modify
Nginx Templates Files for Correct OIP Logging</a>)
for more information and directions.</p>
<p>IP addresses should be supplied in the multi-valued
<strong>zimbraHttpThrottleSafeIPs</strong> attribute.</p>
<blockquote>
<div><p><strong>Tip</strong></p>
<p>Add to <strong>zimbraHttpThrottleSafeIPs</strong> your private networks and/or IP
addresses behind which lay multiple clients.</p>
</div></blockquote>
<p><strong>Examples in ZCS 8.7 or above</strong></p>
<p>The following command adds a single IP and an IP range too
<strong>zimbraHttpThrottleSafeIPs</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zmprov</span> <span class="n">mcf</span> <span class="n">zimbraHttpThrottleSafeIPs</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">234.130</span><span class="o">/</span><span class="mi">32</span> <span class="n">zimbraHttpThrottleSafeIPs</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">4.0</span><span class="o">/</span><span class="mi">24</span>
</pre></div>
</div>
<p>To append the values to an existing list of multi-valued
<strong>zimbraHttpThrottleSafeIPs</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zmprov</span> <span class="n">mcf</span> <span class="o">+</span><span class="n">zimbraHttpThrottleSafeIPs</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">234.130</span><span class="o">/</span><span class="mi">32</span>
<span class="n">zmprov</span> <span class="n">mcf</span> <span class="o">+</span><span class="n">zimbraHttpThrottleSafeIPs</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">4.0</span><span class="o">/</span><span class="mi">24</span>
</pre></div>
</div>
<p>All of this properties require a mailboxd service restart in order for
any change to be applied</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zmmailboxdctl</span> <span class="n">restart</span>
</pre></div>
</div>
</section>
</section>
<section id="oip-logging-issue">
<span id="id11"></span><h3><a class="toc-backref" href="#id41">OIP Logging and non-Zimbra Proxies</a><a class="headerlink" href="#oip-logging-issue" title="Permalink to this headline"></a></h3>
<p>This section contains information useful whenever between a Client and
Zimbra there are proxies or other network devices that are able to
modify the request’s source IP address.</p>
<p>Mailboxd assigns OIP (<strong>O</strong>riginating Client <strong>IP</strong> Address) values
from the HTTP Request header field <code class="docutils literal notranslate"><span class="pre">X-Forwarded-For</span></code>.</p>
<p>When a client connects to the Zimbra WebClient through an HTTP proxy or
a load balancer and once the traffic is intercepted between clients and
servers, the server’s access logs contain the IP address of the proxy or
load balancer only. To see the original IP address of the client, the
<code class="docutils literal notranslate"><span class="pre">X-Forwarded-For</span></code> request header is used, whose general format is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="n">For</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">client</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">ext</span><span class="o">-</span><span class="n">proxy1</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">ext</span><span class="o">-</span><span class="n">proxy2</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">ext</span><span class="o">-</span><span class="n">proxyN</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Here the values form a comma-separated list of the IP addresses:</p>
<ul class="simple">
<li><p>the left-most (&lt;client&gt;) is the original client IP address</p></li>
<li><p>each successive IP address (&lt;ext-proxy1&gt;, &lt;ext-proxy2&gt;, …​) is a
proxy that passed the request, adding the IP address where it
received the request from.</p></li>
<li><p>the right-most IP address (&lt;ext-proxyN&gt;) is the IP address of the
most recent proxy</p></li>
</ul>
<p>Sample log entries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">12020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">26</span> <span class="mi">10</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">38.074</span><span class="p">:</span><span class="n">INFO</span><span class="p">:</span><span class="n">oejs</span><span class="o">.</span><span class="n">DoSFilter</span><span class="p">:</span><span class="n">qtp1684106402</span><span class="o">-</span><span class="mi">771</span><span class="p">::</span> <span class="n">Ignoring</span> <span class="n">malformed</span> <span class="n">remote</span> <span class="n">address</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="p">,</span>  <span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span>
<span class="mi">22020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">26</span> <span class="mi">00</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mf">26.942</span><span class="p">:</span><span class="n">INFO</span><span class="p">:</span><span class="n">oejs</span><span class="o">.</span><span class="n">DoSFilter</span><span class="p">:</span><span class="n">qtp1874154700</span><span class="o">-</span><span class="mi">1750041</span><span class="p">::</span> <span class="n">Ignoring</span> <span class="n">malformed</span> <span class="n">remote</span> <span class="n">address</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="p">,</span> <span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span>
<span class="mi">3</span>
<span class="mi">42019</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">26</span> <span class="mi">06</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span><span class="mi">965</span> <span class="n">INFO</span>  <span class="p">[</span><span class="n">qtp1874154700</span><span class="o">-</span><span class="mi">1886919</span><span class="p">:]</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="n">john</span><span class="o">.</span><span class="n">doe</span><span class="nd">@zimbrasupportlab</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">com</span><span class="p">;</span><span class="n">oip</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="p">,</span> <span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="p">;</span><span class="n">ua</span><span class="o">=</span><span class="n">zclient</span><span class="o">/</span><span class="mf">8.8</span><span class="o">.</span><span class="mi">15</span><span class="n">_GA_1728</span><span class="p">;</span><span class="n">soapId</span><span class="o">=</span><span class="mi">39504524</span><span class="p">;]</span> <span class="n">soap</span> <span class="o">-</span> <span class="n">AuthRequest</span> <span class="n">elapsed</span><span class="o">=</span><span class="mi">1</span>
<span class="mi">52020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">26</span> <span class="mi">07</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">53</span><span class="p">,</span><span class="mi">459</span> <span class="n">INFO</span>  <span class="p">[</span><span class="n">qtp1874154700</span><span class="o">-</span><span class="mi">1900882</span><span class="p">:]</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="n">john</span><span class="o">.</span><span class="n">doe</span><span class="nd">@zimbrasupportlab</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">com</span><span class="p">;</span><span class="n">mid</span><span class="o">=</span><span class="mi">28</span><span class="p">;</span><span class="n">oip</span><span class="o">=</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="p">,</span> <span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="p">;</span><span class="n">ua</span><span class="o">=</span><span class="n">zclient</span><span class="o">/</span><span class="mf">8.8</span><span class="o">.</span><span class="mi">15</span><span class="n">_GA_1728</span><span class="p">;</span><span class="n">soapId</span><span class="o">=</span><span class="mi">39505079</span><span class="p">;]</span> <span class="n">gal</span> <span class="o">-</span> <span class="n">autocomplete</span><span class="p">:</span> <span class="n">overall</span><span class="o">=</span><span class="mi">296</span><span class="n">ms</span><span class="p">,</span> <span class="n">ranking</span><span class="o">=</span><span class="mi">227</span><span class="n">ms</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="mi">2</span><span class="n">ms</span><span class="p">,</span> <span class="n">gal</span><span class="o">=</span><span class="mi">67</span><span class="n">ms</span>
<span class="mi">6</span>
<span class="mi">72020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">28</span> <span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">41.837</span><span class="p">:</span><span class="n">INFO</span><span class="p">:</span><span class="n">oejs</span><span class="o">.</span><span class="n">DoSFilter</span><span class="p">:</span><span class="n">qtp2036958521</span><span class="o">-</span><span class="mi">120378</span><span class="p">:</span><span class="n">https</span><span class="p">::</span> <span class="n">Ignoring</span> <span class="n">malformed</span> <span class="n">remote</span> <span class="n">address</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="p">,</span> <span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span>
<span class="mi">82020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">28</span> <span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">53.907</span><span class="p">:</span><span class="n">INFO</span><span class="p">:</span><span class="n">oejs</span><span class="o">.</span><span class="n">DoSFilter</span><span class="p">:</span><span class="n">qtp2036958521</span><span class="o">-</span><span class="mi">120413</span><span class="p">:</span><span class="n">https</span><span class="p">::</span> <span class="n">Ignoring</span> <span class="n">malformed</span> <span class="n">remote</span> <span class="n">address</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span><span class="p">,</span> <span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span><span class="o">.</span><span class="n">yyy</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">xxx.xxx.xxx.xxx</span></code> is the IP address of the Originating client from
where the request originated or was initiated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">yyy.yyy.yyy.yyy</span></code> is the First Proxy server which will send request
to another proxy server or the destination server.</p></li>
</ul>
<blockquote>
<div><p><strong>Note</strong></p>
<p>If there are multiple proxy servers, then the left most will always
be the IP address of the Originating client. If there is only one
proxy server which forwards request directly to destination server,
then OIP will have only one entry (i.e. for Originating client IP).</p>
</div></blockquote>
</section>
<section id="nginx-templates-oip">
<span id="id12"></span><h3><a class="toc-backref" href="#id42">Modify Nginx Templates Files for Correct OIP Logging</a><a class="headerlink" href="#nginx-templates-oip" title="Permalink to this headline"></a></h3>
<p>In order to properly log the OIP, Nginx templates must be modified.</p>
<blockquote>
<div><p><strong>Warning</strong></p>
<p>These commands must be run as the <strong>ROOT</strong> user!</p>
</div></blockquote>
<p>First, take a backup of existing Nginx conf directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cp -pvr /opt/zimbra/conf/nginx /opt/zimbra/conf/nginx-`date +&quot;%d-%m-%Y&quot;`
</pre></div>
</div>
<p>Next, replace <code class="docutils literal notranslate"><span class="pre">$proxy_add_x_forwarded_for</span></code> with
<code class="docutils literal notranslate"><span class="pre">$http_x_forwarded_for</span></code> in the all template files under
<strong>/opt/zimbra/conf/nginx/templates</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s/$proxy_add_x_forwarded_for/$http_x_forwarded_for/g&#39;</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">zimbra</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">templates</span><span class="o">/*</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>Tip</strong></p>
<p>Replacement must be checked and reapplied after every patch or zimbra
proxy realated installation or upgrade.</p>
</div></blockquote>
<p>Finally, restart the proxy service.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zmproxyctl</span> <span class="n">restart</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>Note</strong></p>
<p>If multiple zimbra-proxy servers present in the setup, then make
these changes on <em>all</em> zimbra-proxies.</p>
</div></blockquote>
</section>
<section id="zimbra-upgrade">
<h3><a class="toc-backref" href="#id43">Zimbra Upgrade</a><a class="headerlink" href="#zimbra-upgrade" title="Permalink to this headline"></a></h3>
<p>When Zimbra is upgraded, the Zextras Core is removed from the server, so
in case of a Zimbra upgrade, Zextras Suite must be reinstalled. All the
data and settings will be maintained, therefore after re-installing the
Zextras Suite, the set up will be exactly the same as before the Zimbra
upgrade.</p>
<blockquote>
<div><p><strong>Warning</strong></p>
<p>Before upgrading your Zimbra server, please make sure that a
compatible Zextras Suite version has been released. A Zextras Suite
<em>compatibility release</em> is usually available within <strong>48</strong> hours
after the release of a new Zimbra version.</p>
</div></blockquote>
</section>
<section id="zimbra-patches">
<span id="id13"></span><h3><a class="toc-backref" href="#id44">Zimbra Patches</a><a class="headerlink" href="#zimbra-patches" title="Permalink to this headline"></a></h3>
<p>The information above only applies to <strong>version upgrades</strong>: installing a
Zimbra patch won’t affect Zextras Suite in any way and thus reinstalling
the package is not required.</p>
</section>
</section>
<section id="quick-installation">
<span id="id14"></span><h2><a class="toc-backref" href="#id45">Quick Installation Guide</a><a class="headerlink" href="#quick-installation" title="Permalink to this headline"></a></h2>
<p>Installation can be carried out in a few steps:</p>
<ol class="arabic simple">
<li><p>Upload to your server the Zextras Suite package you downloaded</p></li>
<li><p>As the <strong>root</strong> user, unpack the file you just downloaded inside a
directory (we suggest in /root/) in your Zimbra server: ‘tar zxf
zextras_suite-latest.tgz’</p></li>
<li><p>Enter the directory created by the unpacking of the file: ‘cd
zextras-suite’</p></li>
<li><p>Run the install.sh script with the <strong>all</strong> option (so ‘./install.sh
all’).</p></li>
<li><p>The installer will take care of downloading the latest available
Core, ZAL and Zimlets for your Zimbra version and start the
installation.</p></li>
</ol>
<section id="zextras-suite-on-multiserver-infrastructures">
<span id="id15"></span><h3><a class="toc-backref" href="#id46">Zextras Suite on Multiserver infrastructures</a><a class="headerlink" href="#zextras-suite-on-multiserver-infrastructures" title="Permalink to this headline"></a></h3>
<p>Depending on the server roles in use, some additional precautions must
be taken:</p>
<section id="setup-single-store">
<span id="id16"></span><h4>Installing Zextras Suite on a Single-store infrastructure<a class="headerlink" href="#setup-single-store" title="Permalink to this headline"></a></h4>
<p>Installing Zextras Suite on a <em>multiserver infrastructure</em> including a
<strong>single mailbox server</strong> is just as easy as installing it on a
single-server infrastructure, as the software must only be installed on
servers running the <code class="docutils literal notranslate"><span class="pre">mailboxd</span></code> service.</p>
</section>
<section id="setup-multiserver">
<span id="id17"></span><h4>Installing Zextras Suite on a Multistore infrastructure<a class="headerlink" href="#setup-multiserver" title="Permalink to this headline"></a></h4>
<p>Zextras Suite installation in a <em>Multistore infrastructure</em> featuring
<strong>multiple mailbox servers</strong> requires the following additional setup:</p>
<ul class="simple">
<li><p>Zextras Suite must be installed on <strong>ALL</strong> the store servers (i.e.,
the ones with the <code class="docutils literal notranslate"><span class="pre">mailboxd</span></code> service running)</p></li>
<li><p>Zextras Suite uses ports <strong>8735</strong> and <strong>8736</strong> for store-to-store
communication, therefore make sure your servers can reach each other
on these port and that the same ports is closed to outside traffic.</p></li>
</ul>
</section>
</section>
</section>
<section id="detailed-instructions">
<span id="id18"></span><h2><a class="toc-backref" href="#id47">Detailed Instructions</a><a class="headerlink" href="#detailed-instructions" title="Permalink to this headline"></a></h2>
<p>Before installing Zextras Suite one will need to have downloaded the
package, as explained in the appropriate section above, and exploded the
archive in a directory of one’s choice.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ tar xfz zextras_suite-latest.tgz
$ ls zextras_suite-latest.tgz zextras_suite/
</pre></div>
</div>
<p>Inside the directory <code class="docutils literal notranslate"><span class="pre">zextras_suite</span></code> one shall find an executable
shell script named <code class="docutils literal notranslate"><span class="pre">install.sh</span></code>, that can be run as <code class="docutils literal notranslate"><span class="pre">./install.sh</span>
<span class="pre">-h</span> <span class="pre">|</span> <span class="pre">./install.sh</span> <span class="pre">[</span> <span class="pre">-u</span> <span class="pre">]</span> <span class="pre">[</span> <span class="pre">-d</span> <span class="pre">]</span> <span class="pre">all|theme|zimlet|core</span></code>. Go to that
directory and run it with <code class="docutils literal notranslate"><span class="pre">-h</span></code> to see a quick description of the
options:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> zextras_suite
$ ./install.sh -h

-h         This very message
-d         Activates debug mode <span class="k">for</span> the install script
-u         Uninstall the target

The targets available <span class="k">for</span> <span class="o">(</span>un<span class="o">)</span>installation are:
core   -- Zextras Suite Core
theme  -- Zextras Suite Theme
zimlet -- Zextras Suite Zimlet
all    -- Zextras Suite Core followed by Zextras Suite Zimlet

* In order to use Zextras Suite, both
* Core and Zimlet need to be installed.
</pre></div>
</div>
<p>A Zextras Theme is automatically installed during a <a class="reference external" href="#zx-full-install">Zextras Suite Full
Installation</a> or <a class="reference external" href="#zx-full-upgrade">Zextras Suite Full
Upgrade</a>, but also a standalone
<code class="docutils literal notranslate"><span class="pre">zextras-theme-installer</span></code> script can be used to install an updated
version of the theme.</p>
<p>In order to successfully perform the Zextras suite installation, one
shall need to either become the <code class="docutils literal notranslate"><span class="pre">root</span></code> user or execute the script with
root privileges (e.g., using sudo).</p>
<p>Once launched, the script will determine the installed Zimbra version
and search for a preexisting installation of either Zextras Suite or
Zextras Migration Tool.</p>
<blockquote>
<div><p><strong>Warning</strong></p>
<p>Should any component of Zextras Migration Tool be detected, you will
be prompted to uninstall them and run again the Zextras Suite
installation script afterwards.</p>
</div></blockquote>
<p>Before proceeding with the installation, you will be required to accept
the EULA of Zextras, after which the actual installation shall take
place.</p>
<section id="zx-full-install">
<span id="id19"></span><h3><a class="toc-backref" href="#id48">Zextras Suite Full Installation</a><a class="headerlink" href="#zx-full-install" title="Permalink to this headline"></a></h3>
<p>In order to install Zextras Suite you need both Core and Zimlet to be
correctly deployed and operational. By choosing <strong>all</strong> as target, Core
and Zimlet will be installed in order, in one go.</p>
<p>Full installation:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">./install.sh</span> <span class="pre">all</span></code></p>
<p>You will need to restart Zimbra after the installation has successfully
completed. The script itself will prompt you to do so.</p>
</section>
<section id="zextras-suite-core-installation">
<span id="zx-core-install"></span><h3><a class="toc-backref" href="#id49">Zextras Suite Core Installation</a><a class="headerlink" href="#zextras-suite-core-installation" title="Permalink to this headline"></a></h3>
<p>In order to install Zextras Core you need to stop the Zimbra services
beforehand. This step can be achieved by either stopping them before
running the script, or having them stopped by the script when prompted.
Afterwards, the script will carry out a series of checks, including for
previous installation of Zextras Core and if needed, it will install the
jar file among the Zimbra extensions.</p>
<p>Core-only installation:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">./install.sh</span> <span class="pre">core</span></code></p>
<p>Once the Core has been deployed, Zimbra must be restarted to verify the
former’s correct operation.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>If you are using the <strong>all</strong> target to install both Core and Zimlet,
the script itself will prompt to start Zimbra.</p>
</div></blockquote>
</section>
<section id="zextras-suite-zimlet-installation">
<span id="zx-zimlet-install"></span><h3><a class="toc-backref" href="#id50">Zextras Suite Zimlet Installation</a><a class="headerlink" href="#zextras-suite-zimlet-installation" title="Permalink to this headline"></a></h3>
<p>Unlike the installation of Zextras Suite Core, in order to install the
Zextras Suite Zimlet you need Zimbra installed and its services running.
As in the Core Installation, you can either proceed manually beforehand
or let the script start them after prompting you to do so. Once Zimbra
is active the administrative zimlet will be deployed with the versions
matching Zimbra’s.</p>
<p>Zimlet-only installation:</p>
<p><code class="docutils literal notranslate"><span class="pre">./install.sh</span> <span class="pre">zimlet</span></code></p>
</section>
<section id="zx-full-upgrade">
<span id="id20"></span><h3><a class="toc-backref" href="#id51">Zextras Suite Full Upgrade</a><a class="headerlink" href="#zx-full-upgrade" title="Permalink to this headline"></a></h3>
<p>In case of an existing instance of Zextras Suite on your system, the
installation of a newer version will automatically perform an upgrade.
Please refer to the instructions above for the installation procedure.</p>
<p>If you just upgraded your Zimbra installation, please see the <a class="reference external" href="#zimbra-upgrade">Zimbra
Upgrade</a> section above.</p>
</section>
<section id="upgrading-zextras-suite-on-a-multiserver-infrastructure">
<span id="id22"></span><h3><a class="toc-backref" href="#id52">Upgrading Zextras Suite on a Multiserver infrastructure</a><a class="headerlink" href="#upgrading-zextras-suite-on-a-multiserver-infrastructure" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Upgrading Zextras Suite to a different <strong>minor</strong> release (e.g.
<strong>2.16.1</strong> to <strong>2.16.2</strong>). Each separate server can be upgraded
independently, and Zextras Suite will be fully functional even in an
environment with mixed minor versions.</p></li>
<li><p>Upgrading Zextras Suite to a different <strong>major</strong> release (e.g.
<strong>2.14.x</strong> to <strong>2.16.x</strong>). All servers should be upgraded at the same
time, as in this case backwards compatibility is <em>not guaranteed</em> and
Zextras Suite will not be fully functional until all nodes have been
upgraded to the same version.</p></li>
</ul>
</section>
<section id="zextras-suite-uninstallation">
<span id="zx-uninstall"></span><h3><a class="toc-backref" href="#id53">Zextras Suite Uninstallation</a><a class="headerlink" href="#zextras-suite-uninstallation" title="Permalink to this headline"></a></h3>
<p>The removal procedure is almost identical to the installation one and
placing the <code class="docutils literal notranslate"><span class="pre">-u</span></code> switch before the target is all is needed. The script
will verify the presence of any Zextras Suite components and prompt for
their removal.</p>
<p>Therefore:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">./install.sh</span> <span class="pre">-u</span> <span class="pre">all</span></code> will uninstall both the Zextras Core and the
Zextras Administration Zimlet</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./install.sh</span> <span class="pre">-u</span> <span class="pre">core</span></code> will uninstall the Zextras Core</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./install.sh</span> <span class="pre">-u</span> <span class="pre">zimlet</span></code> will uninstall the Zextras Administration
Zimlet</p></li>
</ul>
</section>
</section>
<section id="post-install-and-post-uninstall">
<span id="id23"></span><h2><a class="toc-backref" href="#id54">Post-Install and Post-Uninstall</a><a class="headerlink" href="#post-install-and-post-uninstall" title="Permalink to this headline"></a></h2>
<p>After either installing or uninstalling Zextras Suite, it’s highly
suggested to clear both your browser’s and the server’s cache; the
latter task can be carried out by running the command:</p>
<p><code class="docutils literal notranslate"><span class="pre">zmprov</span> <span class="pre">fc</span> <span class="pre">zimlet</span></code></p>
<p>as the <strong>zimbra</strong> user.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>While the Zextras Suite package includes the Zextras Administration
Zimlet, the <em>Zextras Client Zimlet</em> must be deployed separately.</p>
</div></blockquote>
</section>
<section id="additional-components">
<span id="id24"></span><h2><a class="toc-backref" href="#id55">Additional Components</a><a class="headerlink" href="#additional-components" title="Permalink to this headline"></a></h2>
<section id="zextras-client">
<span id="id25"></span><h3><a class="toc-backref" href="#id56">Zextras Client</a><a class="headerlink" href="#zextras-client" title="Permalink to this headline"></a></h3>
<p>Zextras Client allows end users to access new Zextras Suite features,
along with some old ones which were previously available only in the
Zextras Administration Console.</p>
<p>The Zextras Client Zimlet is 100% free, it requires the Zextras Core to
be functional and its deployment is not mandatory. Once deployed, there
are several alternatives to <em>enable</em> it.</p>
<section id="deploy-the-zextras-client">
<span id="id26"></span><h4>Deploy the Zextras Client<a class="headerlink" href="#deploy-the-zextras-client" title="Permalink to this headline"></a></h4>
<p>Deploying the Zextras Client Zimlet is easy, and can be done via either
the Zextras Administration Zimlet or the Zextras CLI in a few steps.</p>
<ul class="simple">
<li><p>Log into the Zimbra Administration Console</p></li>
<li><p>Enter the <strong>Core</strong> section of the Zextras Administration Zimlet</p></li>
<li><p>Click on the <strong>Deploy</strong> button under <em>Zextras Client Zimlet</em></p></li>
<li><p>Once deployed, the zimlet will appear in the deployed zimlets list as
<strong>com_zextras_client</strong>.</p></li>
<li><p>Issue the dedicated Zextras CLI command
<code class="docutils literal notranslate"><span class="pre">zxsuite</span> <span class="pre">core</span> <span class="pre">doDeployClientZimlet</span></code></p></li>
</ul>
<p>Deploying the Zextras Client Zimlet on a <strong>multiserver infrastructure</strong>
requires the same steps as it does on single server environments. The
Zimlet is deployed in LDAP, so you’ll need to only deploy it once
regardless of the number of mailbox servers on your infrastructure.</p>
</section>
</section>
<section id="enable-the-zextras-client">
<span id="id27"></span><h3><a class="toc-backref" href="#id57">Enable the Zextras Client</a><a class="headerlink" href="#enable-the-zextras-client" title="Permalink to this headline"></a></h3>
<p>In order to <strong>enable</strong> the Zextras Client Zimlet, after the deployment
the Zextras Client Zimlet will be only enabled for users belonging to
the default COS.</p>
<p>You can enable the Zextras Client Zimlet for your users in the following
ways:</p>
<ol class="arabic simple">
<li><p>Per user - through the <em>Zimlets</em> section of each user’s settings
within the Zimbra Administration Console</p></li>
<li><p>Per COS - through the <em>Zimlets</em> section of each Class of Service’s
settings within the Zimbra Administration Console</p></li>
<li><p>Via the Zimbra CLI through the <code class="docutils literal notranslate"><span class="pre">zmzimletctl</span></code> command</p></li>
<li><p>Updating the Zextras Client Zimlet</p></li>
</ol>
</section>
<section id="update-the-zextras-client">
<span id="id28"></span><h3><a class="toc-backref" href="#id58">Update the Zextras Client</a><a class="headerlink" href="#update-the-zextras-client" title="Permalink to this headline"></a></h3>
<p>The Zextras Client Zimlet will be automatically updated by the Zextras
Installer when updating Zextras Suite. Should this update fail, manually
pressing the <strong>Deploy</strong> button mentioned above will install the latest
version available.</p>
</section>
<section id="remove-the-zextras-client">
<span id="id29"></span><h3><a class="toc-backref" href="#id59">Remove the Zextras Client</a><a class="headerlink" href="#remove-the-zextras-client" title="Permalink to this headline"></a></h3>
<p>In order to <strong>remove</strong> the Zextras Client Zimlet, click the <strong>Undeploy</strong>
button next to the related entry in the <em>Configure → Zimlets</em> section of
the Zimbra Administration Console or via the Zimbra CLI through the
<code class="docutils literal notranslate"><span class="pre">zmzimletctl</span></code> command.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="general.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="backup.html" class="btn btn-neutral float-right" title="Zextras Backup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The Zextras Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>